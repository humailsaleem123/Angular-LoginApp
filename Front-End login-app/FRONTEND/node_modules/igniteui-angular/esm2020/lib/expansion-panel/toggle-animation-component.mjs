import { Directive, EventEmitter, Inject } from '@angular/core';
import { noop, Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { growVerIn, growVerOut } from '../animations/grow';
import { IgxAngularAnimationService } from '../services/animation/angular-animation-service';
import * as i0 from "@angular/core";
/** @hidden @internal */
export var ANIMATION_TYPE;
(function (ANIMATION_TYPE) {
    ANIMATION_TYPE["OPEN"] = "open";
    ANIMATION_TYPE["CLOSE"] = "close";
})(ANIMATION_TYPE || (ANIMATION_TYPE = {}));
/**@hidden @internal */
// eslint-disable-next-line @angular-eslint/directive-class-suffix
export class ToggleAnimationPlayer {
    constructor(animationService) {
        this.animationService = animationService;
        /** @hidden @internal */
        this.openAnimationDone = new EventEmitter();
        /** @hidden @internal */
        this.closeAnimationDone = new EventEmitter();
        /** @hidden @internal */
        this.openAnimationStart = new EventEmitter();
        /** @hidden @internal */
        this.closeAnimationStart = new EventEmitter();
        /** @hidden @internal */
        this.openAnimationPlayer = null;
        /** @hidden @internal */
        this.closeAnimationPlayer = null;
        this.destroy$ = new Subject();
        this.players = new Map();
        this._animationSettings = {
            openAnimation: growVerIn,
            closeAnimation: growVerOut
        };
        this.closeInterrupted = false;
        this.openInterrupted = false;
        this._defaultClosedCallback = noop;
        this._defaultOpenedCallback = noop;
        this.onClosedCallback = this._defaultClosedCallback;
        this.onOpenedCallback = this._defaultOpenedCallback;
    }
    get animationSettings() {
        return this._animationSettings;
    }
    set animationSettings(value) {
        this._animationSettings = value;
    }
    /** @hidden @internal */
    playOpenAnimation(targetElement, onDone) {
        this.startPlayer(ANIMATION_TYPE.OPEN, targetElement, onDone || this._defaultOpenedCallback);
    }
    /** @hidden @internal */
    playCloseAnimation(targetElement, onDone) {
        this.startPlayer(ANIMATION_TYPE.CLOSE, targetElement, onDone || this._defaultClosedCallback);
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
    startPlayer(type, targetElement, callback) {
        if (!targetElement) { // if no element is passed, there is nothing to animate
            return;
        }
        let target = this.getPlayer(type);
        if (!target) {
            target = this.initializePlayer(type, targetElement, callback);
        }
        // V.S. Jun 28th, 2021 #9783: player will NOT be initialized w/ null settings
        // events will already be emitted
        if (!target || target.hasStarted()) {
            return;
        }
        const targetEmitter = type === ANIMATION_TYPE.OPEN ? this.openAnimationStart : this.closeAnimationStart;
        targetEmitter.emit();
        if (target) {
            target.play();
        }
    }
    initializePlayer(type, targetElement, callback) {
        const oppositeType = type === ANIMATION_TYPE.OPEN ? ANIMATION_TYPE.CLOSE : ANIMATION_TYPE.OPEN;
        // V.S. Jun 28th, 2021 #9783: Treat falsy animation settings as disabled animations
        const targetAnimationSettings = this.animationSettings || { closeAnimation: null, openAnimation: null };
        const animationSettings = type === ANIMATION_TYPE.OPEN ?
            targetAnimationSettings.openAnimation : targetAnimationSettings.closeAnimation;
        // V.S. Jun 28th, 2021 #9783: When no animation in target direction, emit start and done events and return
        if (!animationSettings) {
            this.setCallback(type, callback);
            const targetEmitter = type === ANIMATION_TYPE.OPEN ? this.openAnimationStart : this.closeAnimationStart;
            targetEmitter.emit();
            this.onDoneHandler(type);
            return;
        }
        const opposite = this.getPlayer(oppositeType);
        let oppositePosition = 1;
        if (opposite) {
            oppositePosition = opposite.position;
            this.cleanUpPlayer(oppositeType);
        }
        if (type === ANIMATION_TYPE.OPEN) {
            this.openAnimationPlayer = this.animationService.buildAnimation(animationSettings, targetElement.nativeElement);
        }
        else if (type === ANIMATION_TYPE.CLOSE) {
            this.closeAnimationPlayer = this.animationService.buildAnimation(animationSettings, targetElement.nativeElement);
        }
        const target = this.getPlayer(type);
        target.init();
        this.getPlayer(type).position = 1 - oppositePosition;
        this.setCallback(type, callback);
        target.animationEnd.pipe(takeUntil(this.destroy$)).subscribe(() => {
            this.onDoneHandler(type);
        });
        return target;
    }
    onDoneHandler(type) {
        const targetEmitter = type === ANIMATION_TYPE.OPEN ? this.openAnimationDone : this.closeAnimationDone;
        const targetCallback = type === ANIMATION_TYPE.OPEN ? this.onOpenedCallback : this.onClosedCallback;
        targetCallback();
        if (!(type === ANIMATION_TYPE.OPEN ? this.openInterrupted : this.closeInterrupted)) {
            targetEmitter.emit();
        }
        this.cleanUpPlayer(type);
    }
    setCallback(type, callback) {
        if (type === ANIMATION_TYPE.OPEN) {
            this.onOpenedCallback = callback;
            this.openInterrupted = false;
        }
        else if (type === ANIMATION_TYPE.CLOSE) {
            this.onClosedCallback = callback;
            this.closeInterrupted = false;
        }
    }
    cleanUpPlayer(target) {
        switch (target) {
            case ANIMATION_TYPE.CLOSE:
                if (this.closeAnimationPlayer != null) {
                    this.closeAnimationPlayer.reset();
                    this.closeAnimationPlayer.destroy();
                    this.closeAnimationPlayer = null;
                }
                this.closeInterrupted = true;
                this.onClosedCallback = this._defaultClosedCallback;
                break;
            case ANIMATION_TYPE.OPEN:
                if (this.openAnimationPlayer != null) {
                    this.openAnimationPlayer.reset();
                    this.openAnimationPlayer.destroy();
                    this.openAnimationPlayer = null;
                }
                this.openInterrupted = true;
                this.onOpenedCallback = this._defaultOpenedCallback;
                break;
            default:
                break;
        }
    }
    getPlayer(type) {
        switch (type) {
            case ANIMATION_TYPE.OPEN:
                return this.openAnimationPlayer;
            case ANIMATION_TYPE.CLOSE:
                return this.closeAnimationPlayer;
            default:
                return null;
        }
    }
}
ToggleAnimationPlayer.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.0.0", ngImport: i0, type: ToggleAnimationPlayer, deps: [{ token: IgxAngularAnimationService }], target: i0.ɵɵFactoryTarget.Directive });
ToggleAnimationPlayer.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "14.0.0", type: ToggleAnimationPlayer, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.0.0", ngImport: i0, type: ToggleAnimationPlayer, decorators: [{
            type: Directive
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [IgxAngularAnimationService]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9nZ2xlLWFuaW1hdGlvbi1jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZ25pdGV1aS1hbmd1bGFyL3NyYy9saWIvZXhwYW5zaW9uLXBhbmVsL3RvZ2dsZS1hbmltYXRpb24tY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxTQUFTLEVBQWMsWUFBWSxFQUFFLE1BQU0sRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUN2RixPQUFPLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNyQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUMzRCxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxpREFBaUQsQ0FBQzs7QUFxQjdGLHdCQUF3QjtBQUN4QixNQUFNLENBQU4sSUFBWSxjQUdYO0FBSEQsV0FBWSxjQUFjO0lBQ3RCLCtCQUFhLENBQUE7SUFDYixpQ0FBZSxDQUFBO0FBQ25CLENBQUMsRUFIVyxjQUFjLEtBQWQsY0FBYyxRQUd6QjtBQUVELHVCQUF1QjtBQUV2QixrRUFBa0U7QUFDbEUsTUFBTSxPQUFnQixxQkFBcUI7SUFzQ3ZDLFlBQXlELGdCQUFrQztRQUFsQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBckMzRix3QkFBd0I7UUFDakIsc0JBQWlCLEdBQXVCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbEUsd0JBQXdCO1FBQ2pCLHVCQUFrQixHQUF1QixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ25FLHdCQUF3QjtRQUNqQix1QkFBa0IsR0FBdUIsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNuRSx3QkFBd0I7UUFDakIsd0JBQW1CLEdBQXVCLElBQUksWUFBWSxFQUFFLENBQUM7UUFTcEUsd0JBQXdC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QU07U0FDYjtJQUNMLENBQUM7SUFFTyxTQUFTLENBQUMsSUFBb0I7UUFDbEMsUUFBUSxJQUFJLEVBQUU7WUFDVixLQUFLLGNBQWMsQ0FBQyxJQUFJO2dCQUNwQixPQUFPLElBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUNwQyxLQUFLLGNBQWMsQ0FBQyxLQUFLO2dCQUNyQixPQUFPLElBQUksQ0FBQyxvQkFBb0IsQ0FBQztZQUNyQztnQkFDSSxPQUFPLElBQUksQ0FBQztTQUNuQjtJQUNMLENBQUM7O2tIQXBLaUIscUJBQXFCLGtCQXNDbkIsMEJBQTBCO3NHQXRDNUIscUJBQXFCOzJGQUFyQixxQkFBcUI7a0JBRjFDLFNBQVM7OzBCQXdDTyxNQUFNOzJCQUFDLDBCQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFuaW1hdGlvblJlZmVyZW5jZU1ldGFkYXRhIH0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5qZWN0LCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IG5vb3AsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IGdyb3dWZXJJbiwgZ3Jvd1Zlck91dCB9IGZyb20gJy4uL2FuaW1hdGlvbnMvZ3Jvdyc7XG5pbXBvcnQgeyBJZ3hBbmd1bGFyQW5pbWF0aW9uU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2FuaW1hdGlvbi9hbmd1bGFyLWFuaW1hdGlvbi1zZXJ2aWNlJztcbmltcG9ydCB7IEFuaW1hdGlvblBsYXllciwgQW5pbWF0aW9uU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2FuaW1hdGlvbi9hbmltYXRpb24nO1xuXG4vKipAaGlkZGVuIEBpbnRlcm5hbCAqL1xuZXhwb3J0IGludGVyZmFjZSBUb2dnbGVBbmltYXRpb25TZXR0aW5ncyB7XG4gICAgb3BlbkFuaW1hdGlvbjogQW5pbWF0aW9uUmVmZXJlbmNlTWV0YWRhdGE7XG4gICAgY2xvc2VBbmltYXRpb246IEFuaW1hdGlvblJlZmVyZW5jZU1ldGFkYXRhO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRvZ2dsZUFuaW1hdGlvbk93bmVyIHtcbiAgICBhbmltYXRpb25TZXR0aW5nczogVG9nZ2xlQW5pbWF0aW9uU2V0dGluZ3M7XG4gICAgb3BlbkFuaW1hdGlvblN0YXJ0OiBFdmVudEVtaXR0ZXI8dm9pZD47XG4gICAgb3BlbkFuaW1hdGlvbkRvbmU6IEV2ZW50RW1pdHRlcjx2b2lkPjtcbiAgICBjbG9zZUFuaW1hdGlvblN0YXJ0OiBFdmVudEVtaXR0ZXI8dm9pZD47XG4gICAgY2xvc2VBbmltYXRpb25Eb25lOiBFdmVudEVtaXR0ZXI8dm9pZD47XG4gICAgb3BlbkFuaW1hdGlvblBsYXllcjogQW5pbWF0aW9uUGxheWVyO1xuICAgIGNsb3NlQW5pbWF0aW9uUGxheWVyOiBBbmltYXRpb25QbGF5ZXI7XG4gICAgcGxheU9wZW5BbmltYXRpb24oZWxlbWVudDogRWxlbWVudFJlZiwgb25Eb25lOiAoKSA9PiB2b2lkKTogdm9pZDtcbiAgICBwbGF5Q2xvc2VBbmltYXRpb24oZWxlbWVudDogRWxlbWVudFJlZiwgb25Eb25lOiAoKSA9PiB2b2lkKTogdm9pZDtcbn1cblxuLyoqIEBoaWRkZW4gQGludGVybmFsICovXG5leHBvcnQgZW51bSBBTklNQVRJT05fVFlQRSB7XG4gICAgT1BFTiA9ICdvcGVuJyxcbiAgICBDTE9TRSA9ICdjbG9zZScsXG59XG5cbi8qKkBoaWRkZW4gQGludGVybmFsICovXG5ARGlyZWN0aXZlKClcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvZGlyZWN0aXZlLWNsYXNzLXN1ZmZpeFxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFRvZ2dsZUFuaW1hdGlvblBsYXllciBpbXBsZW1lbnRzIFRvZ2dsZUFuaW1hdGlvbk93bmVyLCBPbkRlc3Ryb3kge1xuICAgIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICAgIHB1YmxpYyBvcGVuQW5pbWF0aW9uRG9uZTogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICAgIHB1YmxpYyBjbG9zZUFuaW1hdGlvbkRvbmU6IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgb3BlbkFuaW1hdGlvblN0YXJ0OiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXG4gICAgcHVibGljIGNsb3NlQW5pbWF0aW9uU3RhcnQ6IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIHB1YmxpYyBnZXQgYW5pbWF0aW9uU2V0dGluZ3MoKTogVG9nZ2xlQW5pbWF0aW9uU2V0dGluZ3Mge1xuICAgICAgICByZXR1cm4gdGhpcy5fYW5pbWF0aW9uU2V0dGluZ3M7XG4gICAgfVxuICAgIHB1YmxpYyBzZXQgYW5pbWF0aW9uU2V0dGluZ3ModmFsdWU6IFRvZ2dsZUFuaW1hdGlvblNldHRpbmdzKSB7XG4gICAgICAgIHRoaXMuX2FuaW1hdGlvblNldHRpbmdzID0gdmFsdWU7XG4gICAgfVxuXG4gICAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXG4gICAgcHVibGljIG9wZW5BbmltYXRpb25QbGF5ZXI6IEFuaW1hdGlvblBsYXllciA9IG51bGw7XG5cbiAgICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgY2xvc2VBbmltYXRpb25QbGF5ZXI6IEFuaW1hdGlvblBsYXllciA9IG51bGw7XG5cbiAgICBwcm90ZWN0ZWQgZGVzdHJveSQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdCgpO1xuICAgIHByb3RlY3RlZCBwbGF5ZXJzOiBNYXA8c3RyaW5nLCBBbmltYXRpb25QbGF5ZXI+ID0gbmV3IE1hcCgpO1xuICAgIHByb3RlY3RlZCBfYW5pbWF0aW9uU2V0dGluZ3M6IFRvZ2dsZUFuaW1hdGlvblNldHRpbmdzID0ge1xuICAgICAgICBvcGVuQW5pbWF0aW9uOiBncm93VmVySW4sXG4gICAgICAgIGNsb3NlQW5pbWF0aW9uOiBncm93VmVyT3V0XG4gICAgfTtcblxuICAgIHByaXZhdGUgY2xvc2VJbnRlcnJ1cHRlZCA9IGZhbHNlO1xuICAgIHByaXZhdGUgb3BlbkludGVycnVwdGVkID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIF9kZWZhdWx0Q2xvc2VkQ2FsbGJhY2sgPSBub29wO1xuICAgIHByaXZhdGUgX2RlZmF1bHRPcGVuZWRDYWxsYmFjayA9IG5vb3A7XG4gICAgcHJpdmF0ZSBvbkNsb3NlZENhbGxiYWNrOiAoKSA9PiBhbnkgPSB0aGlzLl9kZWZhdWx0Q2xvc2VkQ2FsbGJhY2s7XG4gICAgcHJpdmF0ZSBvbk9wZW5lZENhbGxiYWNrOiAoKSA9PiBhbnkgPSB0aGlzLl9kZWZhdWx0T3BlbmVkQ2FsbGJhY2s7XG5cbiAgICBjb25zdHJ1Y3RvcihASW5qZWN0KElneEFuZ3VsYXJBbmltYXRpb25TZXJ2aWNlKXByb3RlY3RlZCBhbmltYXRpb25TZXJ2aWNlOiBBbmltYXRpb25TZXJ2aWNlKSB7XG4gICAgfVxuXG4gICAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXG4gICAgcHVibGljIHBsYXlPcGVuQW5pbWF0aW9uKHRhcmdldEVsZW1lbnQ6IEVsZW1lbnRSZWYsIG9uRG9uZT86ICgpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdGFydFBsYXllcihBTklNQVRJT05fVFlQRS5PUEVOLCB0YXJnZXRFbGVtZW50LCBvbkRvbmUgfHwgdGhpcy5fZGVmYXVsdE9wZW5lZENhbGxiYWNrKTtcbiAgICB9XG5cbiAgICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgcGxheUNsb3NlQW5pbWF0aW9uKHRhcmdldEVsZW1lbnQ6IEVsZW1lbnRSZWYsIG9uRG9uZT86ICgpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdGFydFBsYXllcihBTklNQVRJT05fVFlQRS5DTE9TRSwgdGFyZ2V0RWxlbWVudCwgb25Eb25lIHx8IHRoaXMuX2RlZmF1bHRDbG9zZWRDYWxsYmFjayk7XG4gICAgfVxuICAgIHB1YmxpYyBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5kZXN0cm95JC5uZXh0KCk7XG4gICAgICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXJ0UGxheWVyKHR5cGU6IEFOSU1BVElPTl9UWVBFLCB0YXJnZXRFbGVtZW50OiBFbGVtZW50UmVmLCBjYWxsYmFjazogKCkgPT4gdm9pZCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRhcmdldEVsZW1lbnQpIHsgLy8gaWYgbm8gZWxlbWVudCBpcyBwYXNzZWQsIHRoZXJlIGlzIG5vdGhpbmcgdG8gYW5pbWF0ZVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxldCB0YXJnZXQgPSB0aGlzLmdldFBsYXllcih0eXBlKTtcbiAgICAgICAgaWYgKCF0YXJnZXQpIHtcbiAgICAgICAgICAgIHRhcmdldCA9IHRoaXMuaW5pdGlhbGl6ZVBsYXllcih0eXBlLCB0YXJnZXRFbGVtZW50LCBjYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVi5TLiBKdW4gMjh0aCwgMjAyMSAjOTc4MzogcGxheWVyIHdpbGwgTk9UIGJlIGluaXRpYWxpemVkIHcvIG51bGwgc2V0dGluZ3NcbiAgICAgICAgLy8gZXZlbnRzIHdpbGwgYWxyZWFkeSBiZSBlbWl0dGVkXG4gICAgICAgIGlmICghdGFyZ2V0IHx8IHRhcmdldC5oYXNTdGFydGVkKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0YXJnZXRFbWl0dGVyID0gdHlwZSA9PT0gQU5JTUFUSU9OX1RZUEUuT1BFTiA/IHRoaXMub3BlbkFuaW1hdGlvblN0YXJ0IDogdGhpcy5jbG9zZUFuaW1hdGlvblN0YXJ0O1xuICAgICAgICB0YXJnZXRFbWl0dGVyLmVtaXQoKTtcbiAgICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICAgICAgdGFyZ2V0LnBsYXkoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaW5pdGlhbGl6ZVBsYXllcih0eXBlOiBBTklNQVRJT05fVFlQRSwgdGFyZ2V0RWxlbWVudDogRWxlbWVudFJlZiwgY2FsbGJhY2s6ICgpID0+IHZvaWQpOiBBbmltYXRpb25QbGF5ZXIge1xuICAgICAgICBjb25zdCBvcHBvc2l0ZVR5cGUgPSB0eXBlID09PSBBTklNQVRJT05fVFlQRS5PUEVOID8gQU5JTUFUSU9OX1RZUEUuQ0xPU0UgOiBBTklNQVRJT05fVFlQRS5PUEVOO1xuICAgICAgICAvLyBWLlMuIEp1biAyOHRoLCAyMDIxICM5NzgzOiBUcmVhdCBmYWxzeSBhbmltYXRpb24gc2V0dGluZ3MgYXMgZGlzYWJsZWQgYW5pbWF0aW9uc1xuICAgICAgICBjb25zdCB0YXJnZXRBbmltYXRpb25TZXR0aW5ncyA9IHRoaXMuYW5pbWF0aW9uU2V0dGluZ3MgfHwgeyBjbG9zZUFuaW1hdGlvbjogbnVsbCwgb3BlbkFuaW1hdGlvbjogbnVsbCB9O1xuICAgICAgICBjb25zdCBhbmltYXRpb25TZXR0aW5ncyA9IHR5cGUgPT09IEFOSU1BVElPTl9UWVBFLk9QRU4gP1xuICAgICAgICAgICAgdGFyZ2V0QW5pbWF0aW9uU2V0dGluZ3Mub3BlbkFuaW1hdGlvbiA6IHRhcmdldEFuaW1hdGlvblNldHRpbmdzLmNsb3NlQW5pbWF0aW9uO1xuICAgICAgICAvLyBWLlMuIEp1biAyOHRoLCAyMDIxICM5NzgzOiBXaGVuIG5vIGFuaW1hdGlvbiBpbiB0YXJnZXQgZGlyZWN0aW9uLCBlbWl0IHN0YXJ0IGFuZCBkb25lIGV2ZW50cyBhbmQgcmV0dXJuXG4gICAgICAgIGlmICghYW5pbWF0aW9uU2V0dGluZ3MpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0Q2FsbGJhY2sodHlwZSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0RW1pdHRlciA9IHR5cGUgPT09IEFOSU1BVElPTl9UWVBFLk9QRU4gPyB0aGlzLm9wZW5BbmltYXRpb25TdGFydCA6IHRoaXMuY2xvc2VBbmltYXRpb25TdGFydDtcbiAgICAgICAgICAgIHRhcmdldEVtaXR0ZXIuZW1pdCgpO1xuICAgICAgICAgICAgdGhpcy5vbkRvbmVIYW5kbGVyKHR5cGUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9wcG9zaXRlID0gdGhpcy5nZXRQbGF5ZXIob3Bwb3NpdGVUeXBlKTtcbiAgICAgICAgbGV0IG9wcG9zaXRlUG9zaXRpb24gPSAxO1xuICAgICAgICBpZiAob3Bwb3NpdGUpIHtcbiAgICAgICAgICAgIG9wcG9zaXRlUG9zaXRpb24gPSBvcHBvc2l0ZS5wb3NpdGlvbjtcbiAgICAgICAgICAgIHRoaXMuY2xlYW5VcFBsYXllcihvcHBvc2l0ZVR5cGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlID09PSBBTklNQVRJT05fVFlQRS5PUEVOKSB7XG4gICAgICAgICAgICB0aGlzLm9wZW5BbmltYXRpb25QbGF5ZXIgPSB0aGlzLmFuaW1hdGlvblNlcnZpY2UuYnVpbGRBbmltYXRpb24oYW5pbWF0aW9uU2V0dGluZ3MsIHRhcmdldEVsZW1lbnQubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gQU5JTUFUSU9OX1RZUEUuQ0xPU0UpIHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2VBbmltYXRpb25QbGF5ZXIgPSB0aGlzLmFuaW1hdGlvblNlcnZpY2UuYnVpbGRBbmltYXRpb24oYW5pbWF0aW9uU2V0dGluZ3MsIHRhcmdldEVsZW1lbnQubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5nZXRQbGF5ZXIodHlwZSk7XG4gICAgICAgIHRhcmdldC5pbml0KCk7XG4gICAgICAgIHRoaXMuZ2V0UGxheWVyKHR5cGUpLnBvc2l0aW9uID0gMSAtIG9wcG9zaXRlUG9zaXRpb247XG4gICAgICAgIHRoaXMuc2V0Q2FsbGJhY2sodHlwZSwgY2FsbGJhY2spO1xuICAgICAgICB0YXJnZXQuYW5pbWF0aW9uRW5kLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vbkRvbmVIYW5kbGVyKHR5cGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uRG9uZUhhbmRsZXIodHlwZSkge1xuICAgICAgICBjb25zdCB0YXJnZXRFbWl0dGVyID0gdHlwZSA9PT0gQU5JTUFUSU9OX1RZUEUuT1BFTiA/IHRoaXMub3BlbkFuaW1hdGlvbkRvbmUgOiB0aGlzLmNsb3NlQW5pbWF0aW9uRG9uZTtcbiAgICAgICAgY29uc3QgdGFyZ2V0Q2FsbGJhY2sgPSB0eXBlID09PSBBTklNQVRJT05fVFlQRS5PUEVOID8gdGhpcy5vbk9wZW5lZENhbGxiYWNrIDogdGhpcy5vbkNsb3NlZENhbGxiYWNrO1xuICAgICAgICB0YXJnZXRDYWxsYmFjaygpO1xuICAgICAgICBpZiAoISh0eXBlID09PSBBTklNQVRJT05fVFlQRS5PUEVOID8gdGhpcy5vcGVuSW50ZXJydXB0ZWQgOiB0aGlzLmNsb3NlSW50ZXJydXB0ZWQpKSB7XG4gICAgICAgICAgICB0YXJnZXRFbWl0dGVyLmVtaXQoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsZWFuVXBQbGF5ZXIodHlwZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRDYWxsYmFjayh0eXBlOiBBTklNQVRJT05fVFlQRSwgY2FsbGJhY2s6ICgpID0+IHZvaWQpIHtcbiAgICAgICAgaWYgKHR5cGUgPT09IEFOSU1BVElPTl9UWVBFLk9QRU4pIHtcbiAgICAgICAgICAgIHRoaXMub25PcGVuZWRDYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICAgICAgdGhpcy5vcGVuSW50ZXJydXB0ZWQgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSBBTklNQVRJT05fVFlQRS5DTE9TRSkge1xuICAgICAgICAgICAgdGhpcy5vbkNsb3NlZENhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgICAgICAgICB0aGlzLmNsb3NlSW50ZXJydXB0ZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY2xlYW5VcFBsYXllcih0YXJnZXQ6IEFOSU1BVElPTl9UWVBFKSB7XG4gICAgICAgIHN3aXRjaCAodGFyZ2V0KSB7XG4gICAgICAgICAgICBjYXNlIEFOSU1BVElPTl9UWVBFLkNMT1NFOlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNsb3NlQW5pbWF0aW9uUGxheWVyICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUFuaW1hdGlvblBsYXllci5yZXNldCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlQW5pbWF0aW9uUGxheWVyLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUFuaW1hdGlvblBsYXllciA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VJbnRlcnJ1cHRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkNsb3NlZENhbGxiYWNrID0gdGhpcy5fZGVmYXVsdENsb3NlZENhbGxiYWNrO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBBTklNQVRJT05fVFlQRS5PUEVOOlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wZW5BbmltYXRpb25QbGF5ZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5BbmltYXRpb25QbGF5ZXIucmVzZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuQW5pbWF0aW9uUGxheWVyLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuQW5pbWF0aW9uUGxheWVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuSW50ZXJydXB0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMub25PcGVuZWRDYWxsYmFjayA9IHRoaXMuX2RlZmF1bHRPcGVuZWRDYWxsYmFjaztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFBsYXllcih0eXBlOiBBTklNQVRJT05fVFlQRSk6IEFuaW1hdGlvblBsYXllciB7XG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgY2FzZSBBTklNQVRJT05fVFlQRS5PUEVOOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wZW5BbmltYXRpb25QbGF5ZXI7XG4gICAgICAgICAgICBjYXNlIEFOSU1BVElPTl9UWVBFLkNMT1NFOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNsb3NlQW5pbWF0aW9uUGxheWVyO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==