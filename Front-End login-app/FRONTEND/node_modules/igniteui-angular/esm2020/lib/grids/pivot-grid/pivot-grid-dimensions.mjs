import { CurrentResourceStrings } from '../../core/i18n/resources';
import { GridColumnDataType } from '../../data-operations/data-util';
import { PivotUtil } from './pivot-util';
// Equals to pretty much this configuration:
// {
//     member: () => 'All Periods',
//     enabled: true,
//     fieldName: 'AllPeriods',
//     childLevel: {
//         fieldName: 'Years',
//         member: (rec) => {
//             const recordValue = rec['Date'];
//             return recordValue ? (new Date(recordValue)).getFullYear().toString() : rec['Years'];
//         },
//         enabled: true,
//         childLevel: {
//                 member: (rec) => {
//                     const recordValue = rec['Date'];
//                     return recordValue ? new Date(recordValue).toLocaleString('default', { month: 'long' }) : rec['Months'];
//                 },
//                 enabled: true,
//                 fieldName: 'Months',
//                 childLevel: {
//                         member: 'Date',
//                         fieldName:'Date',
//                         enabled: true
//                     }
//             }
//     }
// },
export class IgxPivotDateDimension {
    /**
     * Creates additional pivot date dimensions based on a provided dimension describing date data:
     *
     * @param inDateDimension Base dimension that is used by this class to determine the other dimensions and their values.
     * @param inOptions Options for the predefined date dimensions whether to show quarter, years and etc.
     * @example
     * ```typescript
     * // Displays only years as parent dimension to the base dimension provided.
     * new IgxPivotDateDimension({ memberName: 'Date', enabled: true }, { total: false, months: false });
     * ```
     */
    constructor(inBaseDimension, inOptions = {}) {
        this.inBaseDimension = inBaseDimension;
        this.inOptions = inOptions;
        /** Enables/Disables a particular dimension from pivot structure. */
        this.enabled = true;
        /** Default options used for initialization. */
        this.defaultOptions = {
            total: true,
            years: true,
            months: true,
            fullDate: true
        };
        /** @hidden @internal */
        this.memberName = 'AllPeriods';
        this._resourceStrings = CurrentResourceStrings.GridResStrings;
        /** @hidden @internal */
        this.memberFunction = (_data) => this.resourceStrings.igx_grid_pivot_date_dimension_total;
        const options = { ...this.defaultOptions, ...inOptions };
        if (!inBaseDimension) {
            console.warn(`Please provide data child level to the pivot dimension.`);
            return;
        }
        this.dataType = GridColumnDataType.Date;
        inBaseDimension.dataType = GridColumnDataType.Date;
        const baseDimension = options.fullDate ? inBaseDimension : null;
        const monthDimensionDef = {
            memberName: 'Months',
            memberFunction: (rec) => {
                const recordValue = PivotUtil.extractValueFromDimension(inBaseDimension, rec);
                return recordValue ? new Date(recordValue).toLocaleString('default', { month: 'long' }) : rec['Months'];
            },
            enabled: true,
            childLevel: baseDimension
        };
        const monthDimension = options.months ? monthDimensionDef : baseDimension;
        const quarterDimensionDef = {
            memberName: 'Quarters',
            memberFunction: (rec) => {
                const recordValue = PivotUtil.extractValueFromDimension(inBaseDimension, rec);
                return recordValue ? `Q` + Math.ceil((new Date(recordValue).getMonth() + 1) / 3) : rec['Quarters'];
            },
            enabled: true,
            childLevel: monthDimension
        };
        const quarterDimension = options.quarters ? quarterDimensionDef : monthDimension;
        const yearsDimensionDef = {
            memberName: 'Years',
            memberFunction: (rec) => {
                const recordValue = PivotUtil.extractValueFromDimension(inBaseDimension, rec);
                return recordValue ? (new Date(recordValue)).getFullYear().toString() : rec['Years'];
            },
            enabled: true,
            childLevel: quarterDimension
        };
        const yearsDimension = options.years ? yearsDimensionDef : quarterDimension;
        this.childLevel = yearsDimension;
        if (!options.total) {
            this.memberName = yearsDimension.memberName;
            this.memberFunction = yearsDimension.memberFunction;
            this.childLevel = yearsDimension.childLevel;
        }
    }
    /**
     * Gets/Sets the resource strings.
     *
     * @remarks
     * By default it uses EN resources.
     */
    set resourceStrings(value) {
        this._resourceStrings = Object.assign({}, this._resourceStrings, value);
    }
    get resourceStrings() {
        return this._resourceStrings;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGl2b3QtZ3JpZC1kaW1lbnNpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaWduaXRldWktYW5ndWxhci9zcmMvbGliL2dyaWRzL3Bpdm90LWdyaWQvcGl2b3QtZ3JpZC1kaW1lbnNpb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBRXJFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFlekMsNENBQTRDO0FBQzVDLElBQUk7QUFDSixtQ0FBbUM7QUFDbkMscUJBQXFCO0FBQ3JCLCtCQUErQjtBQUMvQixvQkFBb0I7QUFDcEIsOEJBQThCO0FBQzlCLDZCQUE2QjtBQUM3QiwrQ0FBK0M7QUFDL0Msb0dBQW9HO0FBQ3BHLGFBQWE7QUFDYix5QkFBeUI7QUFDekIsd0JBQXdCO0FBQ3hCLHFDQUFxQztBQUNyQyx1REFBdUQ7QUFDdkQsK0hBQStIO0FBQy9ILHFCQUFxQjtBQUNyQixpQ0FBaUM7QUFDakMsdUNBQXVDO0FBQ3ZDLGdDQUFnQztBQUNoQywwQ0FBMEM7QUFDMUMsNENBQTRDO0FBQzVDLHdDQUF3QztBQUN4Qyx3QkFBd0I7QUFDeEIsZ0JBQWdCO0FBQ2hCLFFBQVE7QUFDUixLQUFLO0FBQ0wsTUFBTSxPQUFPLHFCQUFxQjtJQXFDOUI7Ozs7Ozs7Ozs7T0FVRztJQUNILFlBQW1CLGVBQWdDLEVBQVMsWUFBd0MsRUFBRTtRQUFuRixvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFBUyxjQUFTLEdBQVQsU0FBUyxDQUFpQztRQS9DdEcsb0VBQW9FO1FBQzdELFlBQU8sR0FBRyxJQUFJLENBQUM7UUFPdEIsK0NBQStDO1FBQ3hDLG1CQUFjLEdBQUc7WUFDcEIsS0FBSyxFQUFFLElBQUk7WUFDWCxLQUFLLEVBQUUs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QVUsRUFBRSxnQkFBZ0I7U0FDL0IsQ0FBQztRQUNGLE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQztRQUM1RSxJQUFJLENBQUMsVUFBVSxHQUFHLGNBQWMsQ0FBQztRQUVqQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRTtZQUNoQixJQUFJLENBQUMsVUFBVSxHQUFHLGNBQWMsQ0FBQyxVQUFVLENBQUM7WUFDNUMsSUFBSSxDQUFDLGNBQWMsR0FBRyxjQUFjLENBQUMsY0FBYyxDQUFDO1lBQ3BELElBQUksQ0FBQyxVQUFVLEdBQUcsY0FBYyxDQUFDLFVBQVUsQ0FBQztTQUMvQztJQUNMLENBQUM7SUFsRkQ7Ozs7O09BS0c7SUFDSCxJQUFXLGVBQWUsQ0FBQyxLQUEyQjtRQUNsRCxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzVFLENBQUM7SUFFRCxJQUFXLGVBQWU7UUFDdEIsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7SUFDakMsQ0FBQztDQTBFSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElHcmlkUmVzb3VyY2VTdHJpbmdzIH0gZnJvbSAnLi4vLi4vY29yZS9pMThuL2dyaWQtcmVzb3VyY2VzJztcbmltcG9ydCB7IEN1cnJlbnRSZXNvdXJjZVN0cmluZ3MgfSBmcm9tICcuLi8uLi9jb3JlL2kxOG4vcmVzb3VyY2VzJztcbmltcG9ydCB7IEdyaWRDb2x1bW5EYXRhVHlwZSB9IGZyb20gJy4uLy4uL2RhdGEtb3BlcmF0aW9ucy9kYXRhLXV0aWwnO1xuaW1wb3J0IHsgSVBpdm90RGltZW5zaW9uIH0gZnJvbSAnLi9waXZvdC1ncmlkLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQaXZvdFV0aWwgfSBmcm9tICcuL3Bpdm90LXV0aWwnO1xuXG5leHBvcnQgaW50ZXJmYWNlIElQaXZvdERhdGVEaW1lbnNpb25PcHRpb25zIHtcbiAgICAvKiogRW5hYmxlcy9EaXNhYmxlcyB0b3RhbCB2YWx1ZSBvZiBhbGwgcGVyaW9kcy4gKi9cbiAgICB0b3RhbD86IGJvb2xlYW47XG4gICAgLyoqIEVuYWJsZXMvRGlzYWJsZXMgZGltZW5zaW9ucyBwZXIgeWVhciBmcm9tIHByb3ZpZGVkIHBlcmlvZHMuICovXG4gICAgeWVhcnM/OiBib29sZWFuO1xuICAgIC8qLyoqIEVuYWJsZXMvRGlzYWJsZXMgZGltZW5zaW9ucyBwZXIgcXVhcnRlciBmcm9tIHByb3ZpZGVkIHBlcmlvZHMuICovXG4gICAgcXVhcnRlcnM/OiBib29sZWFuO1xuICAgIC8qKiBFbmFibGVzL0Rpc2FibGVzIGRpbWVuc2lvbnMgcGVyIG1vbnRoIGZyb20gcHJvdmlkZWQgcGVyaW9kcy4gKi9cbiAgICBtb250aHM/OiBib29sZWFuO1xuICAgIC8qKiBFbmFibGVkL0Rpc2FibGVzIGRpbWVuc2lvbnMgZm9yIHRoZSBmdWxsIGRhdGUgcHJvdmlkZWQgKi9cbiAgICBmdWxsRGF0ZT86IGJvb2xlYW47XG59XG5cbi8vIEVxdWFscyB0byBwcmV0dHkgbXVjaCB0aGlzIGNvbmZpZ3VyYXRpb246XG4vLyB7XG4vLyAgICAgbWVtYmVyOiAoKSA9PiAnQWxsIFBlcmlvZHMnLFxuLy8gICAgIGVuYWJsZWQ6IHRydWUsXG4vLyAgICAgZmllbGROYW1lOiAnQWxsUGVyaW9kcycsXG4vLyAgICAgY2hpbGRMZXZlbDoge1xuLy8gICAgICAgICBmaWVsZE5hbWU6ICdZZWFycycsXG4vLyAgICAgICAgIG1lbWJlcjogKHJlYykgPT4ge1xuLy8gICAgICAgICAgICAgY29uc3QgcmVjb3JkVmFsdWUgPSByZWNbJ0RhdGUnXTtcbi8vICAgICAgICAgICAgIHJldHVybiByZWNvcmRWYWx1ZSA/IChuZXcgRGF0ZShyZWNvcmRWYWx1ZSkpLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKSA6IHJlY1snWWVhcnMnXTtcbi8vICAgICAgICAgfSxcbi8vICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbi8vICAgICAgICAgY2hpbGRMZXZlbDoge1xuLy8gICAgICAgICAgICAgICAgIG1lbWJlcjogKHJlYykgPT4ge1xuLy8gICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNvcmRWYWx1ZSA9IHJlY1snRGF0ZSddO1xuLy8gICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVjb3JkVmFsdWUgPyBuZXcgRGF0ZShyZWNvcmRWYWx1ZSkudG9Mb2NhbGVTdHJpbmcoJ2RlZmF1bHQnLCB7IG1vbnRoOiAnbG9uZycgfSkgOiByZWNbJ01vbnRocyddO1xuLy8gICAgICAgICAgICAgICAgIH0sXG4vLyAgICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbi8vICAgICAgICAgICAgICAgICBmaWVsZE5hbWU6ICdNb250aHMnLFxuLy8gICAgICAgICAgICAgICAgIGNoaWxkTGV2ZWw6IHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgIG1lbWJlcjogJ0RhdGUnLFxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgZmllbGROYW1lOidEYXRlJyxcbi8vICAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWVcbi8vICAgICAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgfVxuLy8gICAgIH1cbi8vIH0sXG5leHBvcnQgY2xhc3MgSWd4UGl2b3REYXRlRGltZW5zaW9uIGltcGxlbWVudHMgSVBpdm90RGltZW5zaW9uIHtcbiAgICAvKiogRW5hYmxlcy9EaXNhYmxlcyBhIHBhcnRpY3VsYXIgZGltZW5zaW9uIGZyb20gcGl2b3Qgc3RydWN0dXJlLiAqL1xuICAgIHB1YmxpYyBlbmFibGVkID0gdHJ1ZTtcbiAgICBcbiAgICAvKipcbiAgICAgKiBHZXRzL1NldHMgZGF0YSB0eXBlXG4gICAgICovXG4gICAgcHVibGljIGRhdGFUeXBlPzogR3JpZENvbHVtbkRhdGFUeXBlO1xuXG4gICAgLyoqIERlZmF1bHQgb3B0aW9ucyB1c2VkIGZvciBpbml0aWFsaXphdGlvbi4gKi9cbiAgICBwdWJsaWMgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICAgIHRvdGFsOiB0cnVlLFxuICAgICAgICB5ZWFyczogdHJ1ZSxcbiAgICAgICAgbW9udGhzOiB0cnVlLFxuICAgICAgICBmdWxsRGF0ZTogdHJ1ZVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHZXRzL1NldHMgdGhlIHJlc291cmNlIHN0cmluZ3MuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIEJ5IGRlZmF1bHQgaXQgdXNlcyBFTiByZXNvdXJjZXMuXG4gICAgICovXG4gICAgcHVibGljIHNldCByZXNvdXJjZVN0cmluZ3ModmFsdWU6IElHcmlkUmVzb3VyY2VTdHJpbmdzKSB7XG4gICAgICAgIHRoaXMuX3Jlc291cmNlU3RyaW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuX3Jlc291cmNlU3RyaW5ncywgdmFsdWUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgcmVzb3VyY2VTdHJpbmdzKCk6IElHcmlkUmVzb3VyY2VTdHJpbmdzIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc291cmNlU3RyaW5ncztcbiAgICB9XG5cbiAgICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgY2hpbGRMZXZlbD86IElQaXZvdERpbWVuc2lvbjtcbiAgICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgbWVtYmVyTmFtZSA9ICdBbGxQZXJpb2RzJztcbiAgICBwcml2YXRlIF9yZXNvdXJjZVN0cmluZ3MgPSBDdXJyZW50UmVzb3VyY2VTdHJpbmdzLkdyaWRSZXNTdHJpbmdzO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhZGRpdGlvbmFsIHBpdm90IGRhdGUgZGltZW5zaW9ucyBiYXNlZCBvbiBhIHByb3ZpZGVkIGRpbWVuc2lvbiBkZXNjcmliaW5nIGRhdGUgZGF0YTpcbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbkRhdGVEaW1lbnNpb24gQmFzZSBkaW1lbnNpb24gdGhhdCBpcyB1c2VkIGJ5IHRoaXMgY2xhc3MgdG8gZGV0ZXJtaW5lIHRoZSBvdGhlciBkaW1lbnNpb25zIGFuZCB0aGVpciB2YWx1ZXMuXG4gICAgICogQHBhcmFtIGluT3B0aW9ucyBPcHRpb25zIGZvciB0aGUgcHJlZGVmaW5lZCBkYXRlIGRpbWVuc2lvbnMgd2hldGhlciB0byBzaG93IHF1YXJ0ZXIsIHllYXJzIGFuZCBldGMuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogLy8gRGlzcGxheXMgb25seSB5ZWFycyBhcyBwYXJlbnQgZGltZW5zaW9uIHRvIHRoZSBiYXNlIGRpbWVuc2lvbiBwcm92aWRlZC5cbiAgICAgKiBuZXcgSWd4UGl2b3REYXRlRGltZW5zaW9uKHsgbWVtYmVyTmFtZTogJ0RhdGUnLCBlbmFibGVkOiB0cnVlIH0sIHsgdG90YWw6IGZhbHNlLCBtb250aHM6IGZhbHNlIH0pO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBpbkJhc2VEaW1lbnNpb246IElQaXZvdERpbWVuc2lvbiwgcHVibGljIGluT3B0aW9uczogSVBpdm90RGF0ZURpbWVuc2lvbk9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCBvcHRpb25zID0geyAuLi50aGlzLmRlZmF1bHRPcHRpb25zLCAuLi5pbk9wdGlvbnMgfTtcblxuICAgICAgICBpZiAoIWluQmFzZURpbWVuc2lvbikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGBQbGVhc2UgcHJvdmlkZSBkYXRhIGNoaWxkIGxldmVsIHRvIHRoZSBwaXZvdCBkaW1lbnNpb24uYCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmRhdGFUeXBlID0gR3JpZENvbHVtbkRhdGFUeXBlLkRhdGU7XG4gICAgICAgIGluQmFzZURpbWVuc2lvbi5kYXRhVHlwZSA9IEdyaWRDb2x1bW5EYXRhVHlwZS5EYXRlO1xuXG4gICAgICAgIGNvbnN0IGJhc2VEaW1lbnNpb24gPSBvcHRpb25zLmZ1bGxEYXRlID8gaW5CYXNlRGltZW5zaW9uIDogbnVsbDtcbiAgICAgICAgY29uc3QgbW9udGhEaW1lbnNpb25EZWY6IElQaXZvdERpbWVuc2lvbiA9IHtcbiAgICAgICAgICAgIG1lbWJlck5hbWU6ICdNb250aHMnLFxuICAgICAgICAgICAgbWVtYmVyRnVuY3Rpb246IChyZWMpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZWNvcmRWYWx1ZSA9IFBpdm90VXRpbC5leHRyYWN0VmFsdWVGcm9tRGltZW5zaW9uKGluQmFzZURpbWVuc2lvbiwgcmVjKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjb3JkVmFsdWUgPyBuZXcgRGF0ZShyZWNvcmRWYWx1ZSkudG9Mb2NhbGVTdHJpbmcoJ2RlZmF1bHQnLCB7IG1vbnRoOiAnbG9uZycgfSkgOiByZWNbJ01vbnRocyddO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICBjaGlsZExldmVsOiBiYXNlRGltZW5zaW9uXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IG1vbnRoRGltZW5zaW9uID0gb3B0aW9ucy5tb250aHMgPyBtb250aERpbWVuc2lvbkRlZiA6IGJhc2VEaW1lbnNpb247XG5cbiAgICAgICAgY29uc3QgcXVhcnRlckRpbWVuc2lvbkRlZjogSVBpdm90RGltZW5zaW9uID0ge1xuICAgICAgICAgICAgbWVtYmVyTmFtZTogJ1F1YXJ0ZXJzJyxcbiAgICAgICAgICAgIG1lbWJlckZ1bmN0aW9uOiAocmVjKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVjb3JkVmFsdWUgPSBQaXZvdFV0aWwuZXh0cmFjdFZhbHVlRnJvbURpbWVuc2lvbihpbkJhc2VEaW1lbnNpb24sIHJlYyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZFZhbHVlID8gYFFgICsgTWF0aC5jZWlsKChuZXcgRGF0ZShyZWNvcmRWYWx1ZSkuZ2V0TW9udGgoKSArIDEpIC8gMykgOiByZWNbJ1F1YXJ0ZXJzJ107XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNoaWxkTGV2ZWw6IG1vbnRoRGltZW5zaW9uXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHF1YXJ0ZXJEaW1lbnNpb24gPSBvcHRpb25zLnF1YXJ0ZXJzID8gcXVhcnRlckRpbWVuc2lvbkRlZiA6IG1vbnRoRGltZW5zaW9uO1xuXG4gICAgICAgIGNvbnN0IHllYXJzRGltZW5zaW9uRGVmOiBJUGl2b3REaW1lbnNpb24gPSB7XG4gICAgICAgICAgICBtZW1iZXJOYW1lOiAnWWVhcnMnLFxuICAgICAgICAgICAgbWVtYmVyRnVuY3Rpb246IChyZWMpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZWNvcmRWYWx1ZSA9IFBpdm90VXRpbC5leHRyYWN0VmFsdWVGcm9tRGltZW5zaW9uKGluQmFzZURpbWVuc2lvbiwgcmVjKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjb3JkVmFsdWUgPyAobmV3IERhdGUocmVjb3JkVmFsdWUpKS5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCkgOiByZWNbJ1llYXJzJ107XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgIGNoaWxkTGV2ZWw6IHF1YXJ0ZXJEaW1lbnNpb25cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgeWVhcnNEaW1lbnNpb24gPSBvcHRpb25zLnllYXJzID8geWVhcnNEaW1lbnNpb25EZWYgOiBxdWFydGVyRGltZW5zaW9uO1xuICAgICAgICB0aGlzLmNoaWxkTGV2ZWwgPSB5ZWFyc0RpbWVuc2lvbjtcblxuICAgICAgICBpZiAoIW9wdGlvbnMudG90YWwpIHtcbiAgICAgICAgICAgIHRoaXMubWVtYmVyTmFtZSA9IHllYXJzRGltZW5zaW9uLm1lbWJlck5hbWU7XG4gICAgICAgICAgICB0aGlzLm1lbWJlckZ1bmN0aW9uID0geWVhcnNEaW1lbnNpb24ubWVtYmVyRnVuY3Rpb247XG4gICAgICAgICAgICB0aGlzLmNoaWxkTGV2ZWwgPSB5ZWFyc0RpbWVuc2lvbi5jaGlsZExldmVsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXG4gICAgcHVibGljIG1lbWJlckZ1bmN0aW9uID0gKF9kYXRhKSA9PiB0aGlzLnJlc291cmNlU3RyaW5ncy5pZ3hfZ3JpZF9waXZvdF9kYXRlX2RpbWVuc2lvbl90b3RhbDtcbn1cbiJdfQ==